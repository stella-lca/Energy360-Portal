<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>LCA Energy Analyzer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="https://cutone.org/wp-content/themes/wp_lcassociates/img/LCA-logo-small.jpg" type="image/x-icon"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    </head>
    <body>
        <h2>Select the Authorization Scope </h2>
        
        <!--<form onsubmit="alert('submit!'); return false">-->
        <form id= "scopeform" onsubmit="return false" method="post">
            <fieldset>
                <legend> Scope Options </legend>
                    
            <div>
            <input type="checkbox" class = "scope-selection" id="consumption-scope" name="scope" value="FB=1_3_4_5_7_10_13_14_18_32_33_35_37_38_40_41_44;IntervalDuration=Monthly_3600_900_300;BlockDuration=Monthly_Daily;HistoryLength=63113904;">Consumption Scope:<br>
            FB=1_3_4_5_7_10_13_14_18_32_33_35_37_38_40_41_44;IntervalDuration=Monthly_3600_900_300;BlockDuration=Monthly_Daily;HistoryLength=63113904;
            </div>
            <div>
            <input type="checkbox" class = "scope-selection" id="billing-info-scope" name="scope" value="FB=1_3_6_10_13_14_15_16_28_32_33_35_37_38_41_44;IntervalDuration=Monthly;BlockDuration=Monthly;HistoryLength=63113904;"> Billing Information Scope:<br>
            FB=1_3_6_10_13_14_15_16_28_32_33_35_37_38_41_44;IntervalDuration=Monthly;BlockDuration=Monthly;HistoryLength=63113904;
            </div>
            <div>
            <input type="checkbox" class = "scope-selection" id="real-time-scope" name="scope" value="FB=1_3_4_5_7_13_14_18_32_33_35_37_38_41_44;IntervalDuration=900_300;BlockDuration=Daily;HistoryLength=86400;">RealTime Scope:<br>
            FB=1_3_4_5_7_13_14_18_32_33_35_37_38_41_44;IntervalDuration=900_300;BlockDuration=Daily;HistoryLength=86400;
            </div>
            <p>
                <label for="scope-select">Select Company for this Authorization</label>
                <select name= "DataCustodianID" required>
                    <option value="ConEdison" selected>CE</option>
                </select>
            </p>
            <input type="submit" value="Submit">
            </fieldset>
        </form>
        <script type="text/javascript">
        //this has to be global value  & saved under LCA database;    
        const client_id = '0oamndzjdfQN5DKZK0h7';
        // need to get account type detail from the login / registration process
        const acTypeDetail = 'CECONY';
        
        $(document).ready(function(){
            $('#scopeform').submit(function(){
                const checked = document.querySelectorAll('input[name="scope"]:checked');
//                console.log(checked.length);
                if(checked.length === 0){
                    alert("At least one of the scopes has to be selected");
                } else {
                    const scope = [... checked].map(selected => selected.value).join('|');
                    const CECONY_redir = `https://www.coned.com/accounts-billing/dashboard/billing-and-usage/share-my-data-connections/third-party-authorization/redirect?client_id=${client_id}&scope=${scope}`; 
                    const ORU_redir = `https://www.oru.com/accounts-billing/dashboard/billing-and-usage/share-my-data-connections/third-party-authorization/redirect?client_id=${client_id}&scope=${scope}`; 
                    console.log(scope);
                    
                    if(acTypeDetail === 'CECONY'){
//                        alert('Your submission was successfully saved');
                        window.location.replace(CECONY_redir);
                    } else if(acTypeDetail === 'ORU'){
                        window.location.replace(CECONY_redir);
                    } else {
                        // error message ... need to be revised later
                        throw "Somthing is wrong ... your account type detail doesn't exist. Please contact with stella@cutone.org" ;
                    }
                }
            });
        });
        </script>
    </body>
    
</html>

